<h1>支払金額一覧</h1>

<%= search_form_for @q do |f| %>
  <%= f.label :payed_on_gteq, "日付" %>
  <%= f.date_field :payed_on_gteq %>
  〜
  <%= f.date_field :payed_on_lteq %>

  <%= f.label :user_id_eq, "ユーザー" %>
  <%= f.select :user_id_eq, User.all.collect { |u| [ u.email, u.id ] }, include_blank: true %>

  <%= f.label :payment_classification_id_eq, "支払い分類" %>
  <%= f.select :payment_classification_id_eq, PaymentClassification.all.collect { |c| [ c.name, c.id ] }, include_blank: true %>

  <%= f.label :payment_method_id_eq, "支払い方法" %>
  <%= f.select :payment_method_id_eq, PaymentMethod.all.collect { |m| [ m.name, m.id ] }, include_blank: true %>

  <br/>
  
  <%= f.submit "検索" %>
<% end %>

合計金額：<%= @payments.sum(:amount) %>

<table>
  <thead>
    <tr>
      <th>支払い日</th>
      <th>支払い金額</th>
      <th>ユーザー</th>
      <th>支払い分類</th>
      <th>支払い方法</th>
      <th>備考</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @payments.each do |payment| %>
      <tr>
        <td><%= payment.payed_on %></td>
        <td><%= payment.amount %></td>
        <td><%= payment.user.email %></td>
        <td><%= payment.payment_classification.name %></td>
        <td><%= payment.payment_method.name %></td>
        <td><%= payment.note %></td>
        <td><%= link_to '詳細', payment %></td>
        <td><%= link_to '編集', edit_payment_path(payment) %></td>
        <td><%= link_to '削除', payment, method: :delete, data: { confirm: '削除してよろしいですか？' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to '新規登録', new_payment_path %>
